{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block title %}
    Sign Up
{% endblock title %}
{% block content %}
    <div class="container">
        <div class="row">
            <!-- Left column -->
            <div class="col-12 col-md-7 left-column">
                <h2>Sign Up</h2>
                {% if invite_code_used %}
                    This invitation code has already been used.
                {% else %}
                    {% if inviter %}
                        <div class="fs-4 mb-3">
                            {% if inviter.is_public %}
                                <a href="{% url 'accounts:detail' inviter.username%}">{{inviter.display_name|default:inviter.username}} </a>
                            {% else %}
                                {{inviter.display_name|default:inviter.username}} 
                            {% endif %}
                            is inviting you to join LÊŒvDB.</div>
                    {% endif %}

                    {% if not user.is_authenticated %}
                        <form method="post">
                            {% csrf_token %}
                            {{ form|crispy }}
                            <button type="submit" class="btn btn-primary">Sign Up</button>
                        </form>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
                const form = document.querySelector("form");
                const signupMethodField = document.querySelector("#id_signup_method");
                const passwordFields = [
                    document.querySelector("#id_password1"),
                    document.querySelector("#id_password2")
                ];
            
                function adjustFormBasedOnSignupMethod() {
                    const method = signupMethodField.value;
                    if (method === "passkey") {
                        // Hide and disable password fields if "Passkey Only" is selected
                        passwordFields.forEach(field => {
                            field.parentNode.style.display = 'none'; // Hide container
                            field.required = false; // Disable required validation
                        });
                    } else {
                        // Show and enable password fields for "Password Only" or "Both"
                        passwordFields.forEach(field => {
                            field.parentNode.style.display = 'block'; // Show container
                            field.required = true; // Enable required validation
                        });
                    }
                }
            
                signupMethodField.addEventListener("change", adjustFormBasedOnSignupMethod);
                adjustFormBasedOnSignupMethod(); // Call initially to set the correct state
        });
    </script>
    <style>
        .readonly-field {
            background-color: var(--bg-highlight) !important;
            border: none;
        }
    </style>

{% endblock content %}
