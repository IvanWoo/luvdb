{% extends "base.html" %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-12 left-column">
                <h2>Searching: "{{ terms|join:'", "' }}"</h2>
                <div class="search-timing col-8">
                    <span class="text-muted">in <span class="execution-time">{{ execution_time|floatformat:5 }}</span> seconds.</span> 
                    {% if execution_time > 0.01 %}
                    <span class="text-muted slow-search-hint">
                        <i class="bg-warning text-white clickable-icon" style="display:inline-block; width:16px; height:16px; border-radius:50%; text-align:center; line-height:16px; cursor: pointer;" data-bs-toggle="collapse" href="#explanationText" role="button" aria-expanded="false" aria-controls="explanationText">!</i>
                        <div class="collapse" id="explanationText" style="margin-top: 5px;">
                            Slow? Use quotes for exact matches to speed up (e.g. "<span class="query-example">{{ query }}</span>"). Multiple terms filter sequentially, causing delays. You can also try narrowing your search by category.
                        </div>
                    </span>
                    {% endif %}
                </div>
                <hr>

                <!--User-->
                {% if user_results %}
                    <h4>Users</h4>
                    {% for user in user_results %}
                        <p>
                            <a href="{% url 'accounts:detail' username=user.username %}">{{ user.display_name | default:user.username }}</a>
                        </p>
                    {% endfor %}
                    <hr>
                {% endif %}

                <!--Entity-->
                {% if person_results %}
                    <h3 class="mb-3">Entity</h3>
                    {% if person_results %}
                        <h4>Persons</h4>
                        {% for person in person_results %}
                            <p>
                                <a href="{% url 'entity:person_detail' person.id %}">{{ person.name|truncatechars:50 }}</a>
                            </p>
                        {% endfor %}
                    {% endif %}
                    <hr>
                {% endif %}

                <!--Read-->
                {% if litwork_results or litinstance_results or book_results or periodical_results or book_series %}
                    <h3 class="mb-3">Read</h3>
                    <div class="row">
                        {% if litwork_results %}
                        <div class="col-12 col-md-4 mb-3">
                            <h4>Works</h4>
                            {% for work in litwork_results %}
                                <p>
                                    <a href="{% url 'read:work_detail' work.id %}">{{ work.title|truncatechars:50 }}</a>
                                    ({{ work.publication_date }})
                                </p>
                            {% endfor %}
                        </div>
                        {% endif %}

                        {% if litinstance_results %}
                        <div class="col-12 col-md-4 mb-3">
                            <h4>Instances</h4>
                            {% for instance in litinstance_results %}
                                <p>
                                    <a href="{% url 'read:instance_detail' instance.id %}">{{ instance.title|truncatechars:50 }}</a>
                                    ({{ instance.publication_date }})
                                </p>
                            {% endfor %}
                        </div>
                        {% endif %}

                        {% if book_results %}
                        <div class="col-12 col-md-4 mb-3">
                            <h4>Book</h4>
                            {% for book in book_results %}
                                <p>
                                    <a href="{% url 'read:book_detail' book.id %}">{{ book.title|truncatechars:50 }}</a>
                                    {# djlint:off #}
                                    ({% if book.format %}{{ book.format }}, {% endif %}{{ book.publication_date }})
                                    {# djlint:on #}
                                </p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    
                    
                    <div class="row mt-2">
                        {% if periodical_results %}
                        <div class="col-12 col-md-4 mb-3">
                            <h4>Periodicals</h4>
                            {% for periodical in periodical_results %}
                                <p>
                                    <a href="{% url 'read:periodical_detail' periodical.id %}">{{ periodical.title|truncatechars:50 }}</a>
                                </p>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        {% if book_series %}
                        <div class="col-12 col-md-4 mb-3">
                            <h4>Book Series</h4>
                            {% for series in book_series %}
                                <p>
                                    <a href="{% url 'read:series_detail' series.id %}">{{ series.title|truncatechars:50 }}</a>
                                </p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    <hr>
                {% endif %}

                <!--Watch-->
                {% if movie_results or series_results %}
                <div class="row">
                    <h3 class="mb-3">Watch</h3>
                    {% if movie_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Movies</h4>
                        {% for movie in movie_results %}
                            <p>
                                <a href="{% url 'watch:movie_detail' movie.id %}">{{ movie.title|truncatechars:50 }}</a>
                                ({{ movie.earliest_release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if series_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Series</h4>
                        {% for serie in series_results %}
                            <p>
                                <a href="{% url 'watch:series_detail' serie.id %}">{{ serie.title|truncatechars:50 }}</a>
                                ({{ serie.release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <hr>
                </div>
                {% endif %}


                <!--Listen-->
                {% if musicwork_results or track_results or release_results or podcast_results or audiobook_results %}
                <div class="row mb-4">
                    <h3 class="mb-3">Listen</h3>
                    {% if musicwork_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Works</h4>
                        {% for work in musicwork_results %}
                            <p>
                                <a href="{% url 'listen:work_detail' work.id %}">{{ work.title|truncatechars:50 }}</a>
                                ({{ work.release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if track_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Tracks</h4>
                        {% for track in track_results %}
                            <p>
                                <a href="{% url 'listen:track_detail' track.id %}">{{ track.title|truncatechars:50 }}</a>
                                ({{ track.release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if release_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Releases</h4>
                        {% for release in release_results %}
                            <p>
                                <a href="{% url 'listen:release_detail' release.id %}">{{ release.title|truncatechars:50 }}</a>
                                ({{ release.release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if podcast_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Podcasts</h4>
                        {% for podcast in podcast_results %}
                            <p>
                                <a href="{% url 'listen:podcast_detail' podcast.id %}">{{ podcast.title|truncatechars:50 }}</a>
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if audiobook_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Audiobooks</h4>
                        {% for audiobook in audiobook_results %}
                            <p>
                                <a href="{% url 'listen:audiobook_detail' audiobook.id %}">{{ audiobook.title|truncatechars:50 }}</a>
                                ({{ audiobook.release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <hr>
                </div>
                {% endif %}

                <!--Play-->
                {% if game_results or gamework_results %}
                <div class="row">
                    <h3 class="mb-3">Play</h3>
                    
                    {% if gamework_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Works</h4>
                        {% for gamework in gamework_results %}
                            <p>
                                <a href="{% url 'play:work_detail' gamework.id %}">{{ gamework.title|truncatechars:50 }}</a>
                                ({{ gamework.first_release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if game_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Games</h4>
                        {% for game in game_results %}
                            <p>
                                <a href="{% url 'play:game_detail' game.id %}">{{ game.title|truncatechars:50 }}</a>
                                ({{ game.earliest_release_date }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <hr>
                </div>
                {% endif %}

                <!--Write-->
                {% if post_results or say_results or pin_results or repost_results %}
                <div class="row">
                    <h3 class="mb-3">Others</h3>
                    {% if post_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Posts</h4>
                        {% for post in post_results %}
                            <p>
                                <a href="{% url 'write:post_detail' post.id %}">{{ post.title }}</a>
                                ({{ post.user.display_name | default:post.user.username }}, {{ post.timestamp|date:"Y.m.d" }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    {% if pin_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Pins</h4>
                        {% for pin in pin_results %}
                            <p>
                                <a href="{% url 'write:pin_detail' pin.id %}">{{ pin.title|truncatechars:50 }}</a>
                                ({{ pin.user.display_name | default:pin.user.username }}, {{ pin.timestamp|date:"Y.m.d" }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if luvlist_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Lists</h4>
                        {% for luvlist in luvlist_results %}
                            <p>
                                <a href="{% url 'write:luvlist_detail' luvlist.id %}">{{ luvlist.title }}</a>
                                ({{ luvlist.user.display_name | default:luvlist.user.username }}, {{ luvlist.timestamp|date:"Y.m.d" }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if say_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Says</h4>
                        {% for say in say_results %}
                            <p>
                                <a href="{% url 'write:say_detail' say.id %}">{{ say.content|truncatechars:30 }}</a>
                                ({{ say.user.display_name | default:say.user.username }}, {{ say.timestamp|date:"Y.m.d" }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if repost_results %}
                    <div class="col-12 col-md-4 mb-3">
                        <h4>Reposts</h4>
                        {% for repost in repost_results %}
                            <p>
                                <a href="{% url 'write:repost_detail' repost.id %}">{{ repost.content|truncatechars:30 }}</a>
                                ({{ repost.user.display_name | default:repost.user.username }}, {{ repost.timestamp|date:"Y.m.d" }})
                            </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <hr>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>
{% endblock %}
