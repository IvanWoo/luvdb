{% load url_filters %}
{% load markdownify %}
{% load linkify %}
{% load past_tense %}

{% if activity.activity_type == 'say' %}  
<!--Say-->  
<div class="activity-item mb-3" data-activity-type="{{ activity.activity_type }}">
    <p>
        <a href="{% url 'accounts:detail' activity.user.username %}">
            {{ activity.user.display_name | default:activity.user.username }}
        </a> {{ activity.activity_type | past_tense}}:
    </p>
    <p>
        {{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify }}
    </p>
    <span class="d-flex mt-3">
        <p style='margin-right: 0.5em'>
            <a href="{% url 'write:say_detail' activity.content_object.id %}" class="link-secondary">{{ activity.timestamp |date:"Y.m.d H:i" }}</a>
        </p>
        {% if activity.content_object.comments_enabled %}
            <p style='margin: 0 0.5em'>
                <a href="{% url 'write:say_detail' activity.content_object.id %}">Reply</a>
            </p>
        {% endif %}
        <p style='margin: 0 0.5em'><a href="{% url 'write:repost_create' activity.id %}">Repost</a></p>
        {% if activity.user == request.user %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:say_update' activity.content_object.id %}">Edit</a></p>
            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
        {% endif %}
    </span>
</div>


{% elif activity.activity_type == 'post' %}
<!--Post-->
<div class="activity-item mb-3" data-activity-type="{{ activity.activity_type }}">
    <p>
        <a href="{% url 'accounts:detail' activity.user.username %}">
            {{ activity.user.display_name | default:activity.user.username }}
        </a> {{ activity.activity_type | past_tense}}:
    </p>
    <p style="background-color:#f9f9f9; padding: 1em;">
        <a href="{% url 'write:post_detail' activity.content_object.id %}">{{activity.content_object.title}}</a>
        <blockquote>{{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify | truncatewords:30 }}</blockquote>
    </p>
    <span class="d-flex mt-3">
        <p style='margin-right: 0.5em'>
            <a href="{% url 'write:post_detail' activity.content_object.id %}" class="link-secondary">{{ activity.timestamp |date:"Y.m.d H:i" }}</a>
        </p>
        {% if activity.content_object.comments_enabled %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:post_detail' activity.content_object.id %}">Reply</a></p>
        {% endif %}
        <p style='margin: 0 0.5em'><a href="{% url 'write:repost_create' activity.id %}">Repost</a></p>
        {% if activity.user == request.user %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:post_update' activity.content_object.id %}">Edit</a></p>
            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
        {% endif %}
    </span>
</div>

{% elif activity.activity_type == 'pin' %}
<!--Pin-->
<div class="activity-item mb-3" data-activity-type="{{ activity.activity_type }}">
    <p>
        <a href="{% url 'accounts:detail' activity.user.username %}">
            {{ activity.user.display_name | default:activity.user.username }}
        </a> {{ activity.activity_type | past_tense}}:
    </p>
    <div style="background-color:#f9f9f9; padding: 1em;">
        <a href="{{ activity.content_object.url }}">{{activity.content_object.title}}</a> 
        (<a href="{% url 'write:pins_from_url' activity.content_object.url|root_url %}" class="link-secondary">{{activity.content_object.url|root_url}}</a>)
        {% if activity.content_object.content %}
        <blockquote>{{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify | truncatewords:200 }}</blockquote>
        {% endif %}
    </div>
    <span class="d-flex mt-2">
        <p style='margin-right: 0.5em'>
            <a href="{% url 'write:pin_detail' activity.content_object.id %}" class="link-secondary">{{ activity.timestamp |date:"Y.m.d H:i" }}</a>
        </p>
        {% if activity.content_object.comments_enabled %}   
            <p style='margin: 0 0.5em'><a href="{% url 'write:pin_detail' activity.content_object.id %}">Reply</a></p>
        {% endif %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:repost_create' activity.id %}">Repost</a></p>
        {% if activity.user != request.user %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:pin_copy' activity.content_object.id %}">Copy</a></p>
        {% endif %}
        {% if activity.user == request.user %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:pin_update' activity.content_object.id %}">Edit</a></p>
            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
        {% endif %}
    </span>
</div>

{% elif activity.activity_type == 'follow' %}
<!--Follow-->
<div class="activity-item mb-3" data-activity-type="{{ activity.activity_type }}">

    <p>
        <a href="{% url 'accounts:detail' activity.user.username %}">
            {{ activity.user.display_name | default:activity.user.username }}
        </a> followed 
        <a href="{% url 'accounts:detail' activity.content_object.followed.username %}">
            {{ activity.content_object.followed.display_name | default:activity.content_object.followed.username }}
        </a>
    </p>

    <span style='display: flex; margin-top: 0.5em; color: gray;'> 
        <p style='margin-right: 0.5em'>   
            {{ activity.timestamp |date:"Y.m.d H:i" }}
        </p>
        {% if activity.user == request.user %}
        <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.content_object.id %}">Delete</a></p>
        {% endif %}
    </span>
</div>

<!--repost--> 
{% elif activity.activity_type == 'repost' %}
<div class="activity-item mb-3" data-activity-type="{{ activity.activity_type }}">
    <p>
        <a href="{% url 'accounts:detail' activity.user.username %}">
            {{ activity.user.display_name | default:activity.user.username }}
        </a> {{ activity.activity_type | past_tense}}:
    </p>
    {% if activity.content_object.content %}
        <p>{{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify | truncatewords:50  }}</p>
    {% endif %}
    <div style="background-color:#f9f9f9; padding: 1em; ">
        <!-- Display the reposted activity -->
        <p>
            <a href="{% url 'accounts:detail' activity.content_object.original_activity.user.username %}">
                {{ activity.content_object.original_activity.user.display_name | default:activity.content_object.original_activity.user.username }}
            </a> {{ activity.content_object.original_activity.activity_type | past_tense }}:
        </p>

        {% if activity.content_object.original_activity.activity_type == "post" %}
        <p><a href="{% url 'write:post_detail' activity.content_object.original_activity.content_object.id %}" >{{ activity.content_object.original_activity.content_object.title }}</a></p>
        {% elif activity.content_object.original_activity.activity_type == "pin" %}
        <p><a href="{{ activity.content_object.original_activity.content_object.url }}" >{{ activity.content_object.original_activity.content_object.title }}</a> ({{  activity.content_object.original_activity.content_object.url | root_url }})</p>
        {% endif %}
        <div style="background-color:#f9f9f9;">
            {{ activity.content_object.original_activity.content_object.content  | linkify_tags | linkify_mentions | markdownify | truncatewords:200 }}
            <p><a href="{{ activity.content_object.original_activity.content_object.get_absolute_url }}" class="link-secondary">{{ activity.content_object.original_activity.content_object.timestamp |date:"Y.m.d H:i" }}</a></p>
        </div>
    </div>
    <span style='display: flex; margin-top:0.5em'>
        <p style='margin-right: 0.5em'>
            <a href="{% url 'write:repost_detail' activity.content_object.id %}" class="link-secondary">{{ activity.timestamp |date:"Y.m.d H:i" }}</a>
        </p>
        {% if activity.content_object.content %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:repost_detail' activity.content_object.id %}">Reply</a></p>
            <p style='margin: 0 0.5em'><a href="{% url 'write:repost_create' activity.id %}">Repost</a></p>
        {% endif %}
        {% if activity.user == request.user %}
            <p style='margin: 0 0.5em'><a href="{% url 'write:repost_update' activity.content_object.id %}">Edit</a></p>
            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
        {% endif %}
    </span> 
</div>   
</div>

{% endif %}