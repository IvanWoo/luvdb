{% extends "base.html" %}
{% load url_filters %}
{% load markdownify %}
{% load linkify %}
{% load crispy_forms_tags %}

{% block content %}

<div class="container">
    <div class="row">
        <div class="col-sm-8">
            <span style='display: flex;'>
                <p style='padding-right:0.5em'>Say</p> | 
                <a href="{% url 'write:post_create' %}"><p style='padding: 0 0.5em'>Post</p></a> | 
                <a href="{% url 'write:pin_create' %}"><p style='padding: 0 0.5em'>Pin</p></a>
            </span>
            <form method="POST">
                {% csrf_token %}
                {{ say_form.content|as_crispy_field }}
                {{ say_form.comments_enabled|as_crispy_field }}
                <button type="submit" class="btn btn-primary btn-sm ">Add Say</button>
            </form>
            <hr>

            {% for activity in object_list %}
            <div>
                <!--Say-->
                {% if activity.activity_type == 'say' %}
                    <a href="{% url 'accounts:detail' activity.user.username %}">
                        {{ activity.user.display_name | default:activity.user.username }}
                    </a> said:
                    <div style="background-color:#f9f9f9; padding: 1em 1em 0.25em 1em;margin-top:0.5em;">
                        {{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify }}
                    </div>
                    <span style='display: flex;'>
                        <p style='margin-right: 0.5em'>{{ activity.timestamp |date:"Y.m.d H:i" }}</p>
                        {% if activity.content_object.comments_enabled %}
                            <p style='margin: 0 0.5em'><a href="{% url 'write:say_detail' activity.content_object.id %}">Reply</a></p>
                        {% endif %}
                        {% if activity.user == request.user %}
                            <p style='margin: 0 0.5em'><a href="{% url 'write:say_update' activity.content_object.id %}">Edit</a></p>
                            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
                        {% endif %}
                    </span>
                    
                <!--Post-->
                {% elif activity.activity_type == 'post' %}
                    <a href="{% url 'accounts:detail' activity.user.username %}">
                        {{ activity.user.display_name | default:activity.user.username }}
                    </a> posted:
                    <div style="background-color:#f9f9f9; padding: 1em;">
                        <a href="{% url 'write:post_detail' activity.content_object.id %}">{{activity.content_object.title}}</a>
                        <blockquote>{{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify | truncatewords:200 }}</blockquote>
                    </div>
                    <span style='display: flex;'>
                        <p style='margin-right: 0.5em'>{{ activity.timestamp | date:"Y.m.d H:i" }}</p>
                        {% if activity.content_object.comments_enabled %}
                            <p style='margin: 0 0.5em'><a href="{% url 'write:post_detail' activity.content_object.id %}">Reply</a></p>
                        {% endif %}
                        {% if activity.user == request.user %}
                            <p style='margin: 0 0.5em'><a href="{% url 'write:post_update' activity.content_object.id %}">Edit</a></p>
                            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
                        {% endif %}
                    </span>

                <!--Pin-->
                {% elif activity.activity_type == 'pin' %}
                    <a href="{% url 'accounts:detail' activity.user.username %}">
                        {{ activity.user.display_name | default:activity.user.username }}
                    </a> pinned:
                    <div style="background-color:#f9f9f9; padding: 1em;">
                        <a href="{{ activity.content_object.url }}">{{activity.content_object.title}}</a> ({{activity.content_object.url|root_url}})
                        <blockquote>{{ activity.content_object.content | linkify_tags | linkify_mentions | markdownify | truncatewords:200 }}</blockquote>
                    </div>
                    <span style='display: flex;'>
                        <p style='margin-right: 0.5em'>{{ activity.timestamp |date:"Y.m.d H:i" }}</p>
                        {% if activity.content_object.comments_enabled %}   
                            <p style='margin: 0 0.5em'><a href="{% url 'write:pin_detail' activity.content_object.id %}">Reply</a></p>
                        {% endif %}
                        {% if activity.user != request.user %}
                            <p style='margin: 0 0.5em'><a href="{% url 'write:pin_copy' activity.content_object.id %}">Copy</a></p>
                        {% endif %}
                        {% if activity.user == request.user %}
                            <p style='margin: 0 0.5em'><a href="{% url 'write:pin_update' activity.content_object.id %}">Edit</a></p>
                            <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.id %}">Delete</a></p>
                        {% endif %}
                    </span>

                <!--Follow-->
                {% elif activity.activity_type == 'follow' %}
                    <p>
                        <a href="{% url 'accounts:detail' activity.user.username %}">
                            {{ activity.user.display_name | default:activity.user.username }}
                        </a> followed 
                        <a href="{% url 'accounts:detail' activity.content_object.followed.username %}">
                            {{ activity.content_object.followed.display_name | default:activity.content_object.followed.username }}
                        </a>
                    </p>

                    <span style='display: flex;'>    
                        {{ activity.timestamp |date:"Y.m.d H:i" }}
                        {% if activity.user == request.user %}
                        <p style='margin: 0 0.5em'><a href="{% url 'activity_feed:activity_delete' activity.content_object.id %}">Delete</a></p>
                        {% endif %}
                    </span>
                {% endif %}

            </div>
            <br/>
        {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
