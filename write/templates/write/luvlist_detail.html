{% extends "base.html" %}
{% load static %}
{% load markdownify %}
{% load linkify %}

{% load crispy_forms_tags %}
{% load url_filters %}
{% block title %}{{ object.title }}{% endblock title%}
{% block content %}
    <div class="container">
        <div class="row">
            <div class='col-12 col-md-8'>
                <h2>{{ object.title }}</h2>
                <div class='d-flex justify-content-between align-items-start mb-2'>
                    <div class="d-flex align-items-start">
                        
                        {% if not object.allow_collaboration %}
                        <div class="me-2">
                            by <a href="{% url 'accounts:detail' object.user.username %}">{{ object.user.display_name | default:object.user.username }}</a>
                        </div>
                        {% endif %}

                        <div class='me-2 text-secondary d-none d-lg-block'>
                            Updated
                            <a href="{% url 'write:luvlist_list' object.user.username %}"
                                class="text-muted">{{ object.updated_at|timesince }} ago</a>
                        </div>
                    </div>    
                    <div class="d-flex justify-content-end align-items-center">
                        <form method="post" action="">
                            {% csrf_token %}
                            <button class="btn btn-outline-secondary btn-sm align-items-center me-2"
                                type="submit" name="order" value="{% if order == 'ASC' %}DESC{% else %}ASC{% endif %}"
                                title="Change order from {% if order == 'ASC' %}ascending{%else%}descending{%endif%} to {% if order == 'ASC' %}descending{%else%}ascending{%endif%}"
                                aria-label="Item Order button">
                                {% if order == 'ASC' %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sort-down-alt" viewBox="0 0 16 16">
                                        <path d="M3.5 3.5a.5.5 0 0 0-1 0v8.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L3.5 12.293V3.5zm4 .5a.5.5 0 0 1 0-1h1a.5.5 0 0 1 0 1h-1zm0 3a.5.5 0 0 1 0-1h3a.5.5 0 0 1 0 1h-3zm0 3a.5.5 0 0 1 0-1h5a.5.5 0 0 1 0 1h-5zM7 12.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5z"/>
                                    </svg>
                                {% else %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sort-up" viewBox="0 0 16 16">
                                        <path d="M3.5 12.5a.5.5 0 0 1-1 0V3.707L1.354 4.854a.5.5 0 1 1-.708-.708l2-1.999.007-.007a.498.498 0 0 1 .7.006l2 2a.5.5 0 1 1-.707.708L3.5 3.707V12.5zm3.5-9a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM7.5 6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zm0 3a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z"/>
                                    </svg>
                                {% endif %}
                            </button>
                        </form>
                        
                        <a href="{% url 'discover:vote' 'luvlist' object.id 'up' %}" 
                            class="me-2 btn btn-sm {% if has_voted %}btn-outline-danger active{% else %}btn-outline-danger{% endif %} align-items-center" 
                            title="Like this list"
                            aria-label="Like button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                                <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                            </svg>
                        </a>
                        {% if object.allow_collaboration %}
                            <a href="{% url 'write:surprise_collab' object.id %}" 
                                class="btn btn-outline-primary btn-sm align-items-center"
                                title="surprise me"
                                aria-label="surprise me button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"/>
                                    <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/>
                                </svg>
                            </a>
                        {% else %}
                            <a href="{% url 'write:surprise' object.user.username object.id %}" 
                                class="btn btn-outline-primary btn-sm align-items-center"
                                title="surprise me"
                                aria-label="surprise me button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"/>
                                    <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/>
                                </svg>
                            </a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mb-2">
                    {{ object.notes|linkify_tags:object.user|markdownify}}
                </div>
                <div class="mb-3 me-2 text-secondary d-lg-none">
                    Updated
                    <a href="{% url 'write:luvlist_list' object.user.username %}"
                        class="text-muted">{{ object.updated_at|timesince }} ago</a>
                </div>
                
                <hr>

                {% for content in contents %}
                    {% if content.content_object %}
                        {% if content.content_type.model == 'luvlist' %}
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3">
                                    <a href="{% url 'write:luvlist_detail' content.content_object.user.username content.content_object.id %}"
                                       class="text-decoration-none ">
                                        <div class="fs-5">{{ content.content_object.title }}</div>
                                    </a>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | List</div>
                            </div>
                        {% elif content.content_type.model == 'say' %}
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3">
                                    <div class="d-flex">
                                        <a href="{% url 'accounts:detail' content.content_object.user.username %}"
                                           class='me-1'>
                                            {{ content.content_object.user.display_name | default:content.content_object.user.username }}
                                        </a> said:
                                    </div>
                                    <div class="mt-2 p-3">
                                        <div>
                                            {{ content.content_object.content| linkify_tags:content.content_object.user | linkify_mentions | markdownify }}
                                        </div>
                                    </div>
                                    <span class="d-flex mt-2">
                                        <p class='me-2 text-secondary mb-2'>
                                            <a href="{% url "write:say_detail" content.content_object.user.username content.content_object.id %}"
                                               class="text-muted">{{ object.timestamp|date:"Y.m.d H:i" }}</a>
                                        </p>
                                    </span>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Say</div>
                            </div>
                        {% elif content.content_type.model == 'pin' %}
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3">
                                    <div class="d-flex">
                                        <a href="{% url 'accounts:detail' content.content_object.user.username %}"
                                           class='me-1'>
                                            {{ content.content_object.user.display_name | default:content.content_object.user.username }}
                                        </a> pinned:
                                    </div>
                                    <div class="mt-2 p-3">
                                        <div>
                                            <a href="{{ content.content_object.url }}" class="text-decoration-none">{{ content.content_object.title }}</a>
                                            (<a href="{% url 'write:pins_from_url' content.content_object.url|root_url %}"
   class="text-decoration-none text-secondary">{{ content.content_object.url|root_url }}</a>)
                                        </div>
                                        {% if content.content_object.content %}
                                            <div>{{ content.content_object.content | linkify_tags | linkify_mentions | truncatechars:300 | markdownify }}</div>
                                        {% endif %}
                                    </div>
                                    <span class="d-flex mt-2">
                                        <p class='me-2 text-secondary mb-2'>
                                            <a href="{% url "write:pin_detail" content.content_object.user.username content.content_object.id %}"
                                               class="text-muted">{{ object.timestamp|date:"Y.m.d H:i" }}</a>
                                        </p>
                                    </span>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Pin</div>
                            </div>
                        {% elif content.content_type.model == 'post' %}
                            <!--Post-->
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3">
                                    <div class="d-flex">
                                        <a href="{% url 'accounts:detail' content.content_object.user.username %}"
                                           class='me-1'>
                                            {{ content.content_object.user.display_name | default:content.content_object.user.username }}
                                        </a> posted:
                                    </div>
                                    <div class="mt-2 p-3">
                                        <div>
                                            <a href="{% url 'write:post_detail_slug' content.content_object.user.username content.content_object.slug %}"
                                               class="text-decoration-none">{{ content.content_object.title }}</a>
                                        </div>
                                        <div>{{ content.content_object.content | linkify_tags | linkify_mentions | truncatechars:300 | markdownify }}</div>
                                    </div>
                                    <span class="d-flex mt-2">
                                        <p class='me-2 text-secondary mb-2'>
                                            <a href="{% url "write:post_detail_slug" content.content_object.user.username content.content_object.slug %}"
                                               class="text-muted">{{ object.timestamp|date:"Y.m.d H:i" }}</a>
                                        </p>
                                    </span>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Post</div>
                            </div>
                        {% elif content.content_type.model == 'repost' %}
                            <!--Post-->
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3">
                                    <div class="d-flex">
                                        <a href="{% url 'accounts:detail' content.content_object.user.username %}"
                                           class='me-1'>
                                            {{ content.content_object.user.display_name | default:content.content_object.user.username }}
                                        </a> reposted:
                                    </div>
                                    <div class="mt-2 p-3">
                                        <div>
                                            <a href="{% url 'write:repost_detail' content.content_object.user.username content.content_object.id %}"
                                               class="text-decoration-none">{{ content.content_object.title }}</a>
                                        </div>
                                        <div>{{ content.content_object.content | linkify_tags | linkify_mentions | truncatechars:300 | markdownify }}</div>
                                    </div>
                                    <span class="d-flex mt-2">
                                        <p class='me-2 text-secondary mb-2'>
                                            <a href="{% url "write:repost_detail" content.content_object.user.username content.content_object.id %}"
                                               class="text-muted">{{ object.timestamp|date:"Y.m.d H:i" }}</a>
                                        </p>
                                    </span>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Post</div>
                            </div>
                        {% elif content.content_type.model == 'book' or content.content_type.model == 'issue' %}
                            <!--Book-->
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3 d-flex">
                                    <div class="mt-1 mb-3 mb-md-0 flex-shrink-0 checkin-cover">
                                        {% if user.pure_text_mode %}
                                            <div class="cover-placeholder bg-light">{{ content.content_object.title }}</div>
                                        {% else %}
                                            {% if content.content_object.cover %}
                                                {% if content.content_object.cover_sens %}
                                                    <img src="{{ content.content_object.cover.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        style="width: 100%"
                                                        class="img-fluid blur cover-border"
                                                        onclick="this.classList.toggle('blur')">
                                                {% else %}
                                                    <img src="{{ content.content_object.cover.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        class="img-fluid cover-border"
                                                        onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\'cover-placeholder\'>{{ content.content_object.title }}</div>';">
                                                        {% endif %}
                                            {% else %}
                                                <div class="cover-placeholder">{{ content.content_object.title }}</div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        {% if content.content_type.model == 'book' %}
                                            <a href=" {% url 'read:book_detail' content.content_object.id %} "
                                               class="text-decoration-none ">
                                                <div class="fs-5">{{ content.content_object.title }}</div>
                                            </a>
                                        {% elif content.content_type.model == 'issue' %}
                                            <div class="fs-5">{{ content.content_object.periodical.title }}</div>
                                            <a href=" {% url 'read:issue_detail' content.content_object.periodical.id content.content_object.id %} "
                                               class="text-decoration-none ">
                                                <div class="fs-6">{{ content.content_object.title }}</div>
                                            </a>
                                        {% endif %}
                                        {% if content.content_type.model == 'book' %}
                                            {% regroup content.content_object.bookrole_set.all by role as roles_list %}
                                            {% for role in roles_list %}
                                                <div>
                                                    {# djlint:off #}
                                                    {{ role.grouper.name }}{% if role.list|length > 1 %}s{% endif %}:
                                                    {# djlint:on #}
                                                    {% for book_role in role.list %}
                                                        {% if not forloop.first %}/{% endif %}
                                                        <a href="{% url 'entity:creator_detail' book_role.creator.id %}">
                                                            {{ book_role.alt_name | default:book_role.creator.name }}
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                        <div>
                                            {% if content.content_object.publication_date %}Date: {{ content.content_object.publication_date }}{% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Book</div>
                            </div>
                        {% elif content.content_type.model == 'movie' or content.content_type.model == 'series' %}
                            <!--Movie/Series-->
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3 d-flex">
                                    <div class="mt-1 mb-3 mb-md-0 flex-shrink-0 checkin-cover">
                                        {% if user.pure_text_mode %}
                                            <div class="cover-placeholder bg-light">{{ content.content_object.title }}</div>
                                        {% else %}
                                            {% if content.content_object.poster %}
                                                {% if content.content_object.poster_sens %}
                                                    <img src="{{ content.content_object.poster.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        style="width: 100%"
                                                        class="img-fluid blur cover-border"
                                                        onclick="this.classList.toggle('blur')">
                                                {% else %}
                                                    <img src="{{ content.content_object.poster.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        class="img-fluid cover-border"
                                                        onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\'cover-placeholder\'>{{ content.content_object.title }}</div>';">
                                                        {% endif %}
                                            {% else %}
                                                <div class="cover-placeholder">{{ content.content_object.title }}</div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        {% if content.content_type.model == 'movie' %}
                                            <a href=" {% url 'watch:movie_detail' content.content_object.id %} "
                                               class="text-decoration-none ">
                                                <div class="fs-5">{{ content.content_object.title }}</div>
                                            </a>
                                        {% elif content.content_type.model == 'series' %}
                                            <a href=" {% url 'watch:series_detail' content.content_object.id %} "
                                               class="text-decoration-none ">
                                                <div class="fs-5">{{ content.content_object.title }}</div>
                                            </a>
                                        {% endif %}
                                        {% if content.content_type.model == 'movie' %}
                                            {% regroup content.content_object.movieroles.all by role as roles_list %}
                                            {% for role in roles_list %}
                                                <div>
                                                    {# djlint:off #}
                                                    {{ role.grouper.name }}{% if role.list|length > 1 %}s{% endif %}:
                                                    {# djlint:on #}
                                                    {% for movie_role in role.list %}
                                                        {% if not forloop.first %}/{% endif %}
                                                        <a href="{% url 'entity:creator_detail' movie_role.creator.id %}">
                                                            {{ movie_role.alt_name | default:movie_role.creator.name }}
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            {% regroup content.content_object.seriesroles.all by role as roles_list %}
                                            {% for role in roles_list %}
                                                <div>
                                                    {# djlint:off #}
                                                    {{ role.grouper.name }}{% if role.list|length > 1 %}s{% endif %}:
                                                    {# djlint:on #}
                                                    {% for series_role in role.list %}
                                                        {% if not forloop.first %}/{% endif %}
                                                        <a href="{% url 'entity:creator_detail' series_role.creator.id %}">
                                                            {{ series_role.alt_name | default:series_role.creator.name }}
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                        {% if content.content_object.release_date %}
                                        <div>
                                            Date: {{ content.content_object.release_date }}
                                        </div>
                                        {% endif %}
                                        {% if content.content_object.region_release_dates.all %}
                                            {% with earliest_region_release_date=content.content_object.region_release_dates.all|first %}
                                                Date: {{earliest_region_release_date.release_date}} ({{earliest_region_release_date.region}})
                                            {% endwith %}
                                        {% endif %}
                                    </div>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">
                                    Added on {{ content.timestamp|date:"Y.m.d H:i" }} |
                                    {% if content.content_type.model == 'movie' %}
                                        Movie
                                    {% elif content.content_type.model == 'series' %}
                                        Series
                                    {% endif %}
                                </div>
                            </div>
                        {% elif content.content_type.model == 'release' %}
                            <!--Music-->
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3 d-flex">
                                    <div class="mt-1 mb-3 mb-md-0 flex-shrink-0 checkin-cover">
                                        {% if user.pure_text_mode %}
                                            <div class="listen-cover-placeholder bg-light">{{ content.content_object.title }}</div>
                                        {% else %}
                                            {% if content.content_object.cover %}
                                                {% if content.content_object.cover_sens %}
                                                    <img src="{{ content.content_object.cover.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        style="width: 100%"
                                                        class="img-fluid blur cover-border"
                                                        onclick="this.classList.toggle('blur')">
                                                {% else %}
                                                    <img src="{{ content.content_object.cover.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        class="img-fluid cover-border"
                                                        onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\'cover-placeholder\'>{{ content.content_object.title }}</div>';">
                                                {% endif %}
                                            {% else %}
                                                <div class="listen-cover-placeholder">{{ content.content_object.title }}</div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <a href="{% url 'listen:release_detail' content.content_object.id %}"
                                           class="text-decoration-none ">
                                            <div class="fs-5">{{ content.content_object.title }}</div>
                                        </a>
                                        {% regroup content.content_object.releaserole_set.all by role as roles_list %}
                                        {% for role in roles_list %}
                                            <div>
                                                {# djlint:off #}
                                                {{ role.grouper.name }}{% if role.list|length > 1 %}s{% endif %}:
                                                {# djlint:on #}
                                                {% for release_role in role.list %}
                                                    {% if not forloop.first %}/{% endif %}
                                                    <a href="{% url 'entity:creator_detail' release_role.creator.id %}">
                                                        {{ release_role.alt_name | default:release_role.creator.name }}
                                                    </a>
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                        <div>
                                            {% if content.content_object.labels %}
                                                {# djlint:off #}
                                                Label{% if content.content_object.labels.list|length > 1 %}s{% endif %}:
                                                {# djlint:on #}
                                                {% for label in content.content_object.labels.all %}
                                                    {% if not forloop.first %},{% endif %}
                                                    <a href="{% url 'entity:company_detail' label.id %}">{{ label.name }}</a>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        {% if content.content_object.release_date %}
                                        <div>
                                            Release Date: {{ content.content_object.release_date }}
                                        </div>
                                        {% endif %}
                                        {% if content.content_object.catalog_number %}
                                            Catalog Number: {{ content.content_object.catalog_number }}
                                        {% endif %}
                                        <div class="d-flex align-items-center mt-1">
                                            {% if content.content_object.spotify_url %}
                                                <a href="{{content.content_object.spotify_url}}" aria-label="Open in Spotify" class="me-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="32" height="32" viewBox="0 0 50 50" style="fill: var(--text-default);">
                                                        <path d="M25.009,1.982C12.322,1.982,2,12.304,2,24.991S12.322,48,25.009,48s23.009-10.321,23.009-23.009S37.696,1.982,25.009,1.982z M34.748,35.333c-0.289,0.434-0.765,0.668-1.25,0.668c-0.286,0-0.575-0.081-0.831-0.252C30.194,34.1,26,33,22.5,33.001 c-3.714,0.002-6.498,0.914-6.526,0.923c-0.784,0.266-1.635-0.162-1.897-0.948s0.163-1.636,0.949-1.897 c0.132-0.044,3.279-1.075,7.474-1.077C26,30,30.868,30.944,34.332,33.253C35.022,33.713,35.208,34.644,34.748,35.333z M37.74,29.193 c-0.325,0.522-0.886,0.809-1.459,0.809c-0.31,0-0.624-0.083-0.906-0.26c-4.484-2.794-9.092-3.385-13.062-3.35 c-4.482,0.04-8.066,0.895-8.127,0.913c-0.907,0.258-1.861-0.272-2.12-1.183c-0.259-0.913,0.272-1.862,1.184-2.12 c0.277-0.079,3.854-0.959,8.751-1c4.465-0.037,10.029,0.61,15.191,3.826C37.995,27.328,38.242,28.388,37.74,29.193z M40.725,22.013 C40.352,22.647,39.684,23,38.998,23c-0.344,0-0.692-0.089-1.011-0.275c-5.226-3.068-11.58-3.719-15.99-3.725 c-0.021,0-0.042,0-0.063,0c-5.333,0-9.44,0.938-9.481,0.948c-1.078,0.247-2.151-0.419-2.401-1.495 c-0.25-1.075,0.417-2.149,1.492-2.4C11.729,16.01,16.117,15,21.934,15c0.023,0,0.046,0,0.069,0 c4.905,0.007,12.011,0.753,18.01,4.275C40.965,19.835,41.284,21.061,40.725,22.013z"></path>
                                                    </svg>      
                                                </a>    
                                            {% endif %}
                                            {% if content.content_object.apple_music_url %}
                                                <a href="{{content.content_object.apple_music_url}}" aria-label="Open in Apple Music" class="me-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="32" height="32" viewBox="0 0 50 50" style="fill: var(--text-default);">
                                                        <path d="M37,4H13c-4.962,0-9,4.037-9,9v24c0,4.963,4.038,9,9,9h24c4.962,0,9-4.037,9-9V13C46,8.037,41.962,4,37,4z M35,27v4v0.021	h-0.002C34.986,33.768,32.749,36,30,36h-0.5c-0.987,0-1.933-0.42-2.596-1.152c-0.662-0.731-0.985-1.718-0.887-2.705	C26.195,30.38,27.787,29,29.643,29H31c1.103,0,2-0.897,2-2v-9.795l-12,2.25V30v4c0,2.757-2.243,5-5,5h-0.5	c-0.987,0-1.933-0.42-2.596-1.152c-0.662-0.731-0.985-1.718-0.887-2.705C12.195,33.38,13.787,32,15.643,32H17c1.103,0,2-0.897,2-2	V15.353c0-0.963,0.687-1.79,1.633-1.966l12.591-2.36c0.439-0.083,0.891,0.033,1.234,0.319C34.803,11.632,35,12.053,35,12.5V27z"></path>
                                                    </svg>
                                                </a>
                                            {% endif %}
                                            {% if content.content_object.wikipedia %}
                                                <a href="{{content.content_object.wikipedia}}" aria-label="Open in Wikipedia" class="me-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="31" height="31" viewBox="0 0 50 50" style="fill: var(--text-default);">
                                                        <path d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M42,17.56 c0,0.18-0.18,0.35-0.36,0.35h-2.06l-9.21,18.92C30.28,36.91,30.19,37,30.01,37s-0.27-0.09-0.36-0.17l-4.38-8.54l-4.74,8.54 C20.44,36.91,20.35,37,20.17,37s-0.27-0.09-0.36-0.17L10.51,18H8.36C8.18,18,8,17.83,8,17.65v-1.3C8,16.17,8.18,16,8.36,16h7.28 c0.18,0,0.36,0.17,0.36,0.35v1.3c0,0.18-0.18,0.35-0.36,0.35h-1.38l6.45,14.12l3.4-6.1L19.81,18h-1.43c-0.18,0-0.36-0.17-0.36-0.35 v-1.3c0-0.18,0.18-0.35,0.36-0.35h6.26c0.18,0,0.36,0.17,0.36,0.35v1.3c0,0.18-0.18,0.35-0.36,0.35h-1.25l2.42,4.88L28.76,18h-1.4 C27.18,18,27,17.83,27,17.65v-1.3c0-0.18,0.18-0.35,0.36-0.35h5.28c0.18,0,0.36,0.17,0.36,0.35v1.3c0,0.18-0.18,0.35-0.36,0.35 h-1.38l-4.29,7.15l3.49,6.97L37.17,18h-1.81C35.18,18,35,17.83,35,17.65v-1.3c0-0.18,0.18-0.35,0.36-0.35h6.28 c0.18,0,0.36,0.17,0.36,0.35V17.56z"></path>
                                                    </svg>
                                                </a>
                                            {% endif %}
                                            {% if content.content_object.discogs %}
                                            <a href="{{content.content_object.discogs}}" aria-label="Open in Discogs" class="me-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="32" height="32" viewBox="0 0 50 50" style="fill: var(--text-default);">
                                                    <path d="M 25 2 C 12.318 2 2 12.318 2 25 C 2 31.39 4.62175 37.177609 8.84375 41.349609 L 10.912109 39.179688 C 7.2641094 35.554688 5 30.537 5 25 C 5 13.972 13.972 5 25 5 C 28.326 5 31.457703 5.8284844 34.220703 7.2714844 L 35.626953 4.6113281 C 32.445953 2.9463281 28.832 2 25 2 z M 25 7 C 15.075 7 7 15.075 7 25 C 7 29.968 9.0230625 34.472422 12.289062 37.732422 L 14.359375 35.558594 C 11.667375 32.846594 10 29.115 10 25 C 10 16.729 16.729 10 25 10 C 27.483 10 29.822719 10.616453 31.886719 11.689453 L 33.287109 9.0371094 C 30.804109 7.7421094 27.989 7 25 7 z M 40.986328 8.4863281 L 38.912109 10.662109 C 42.660109 14.298109 45 19.378 45 25 C 45 36.028 36.028 45 25 45 C 21.595 45 18.388125 44.139813 15.578125 42.632812 L 14.230469 45.314453 C 17.445469 47.026453 21.11 48 25 48 C 37.682 48 48 37.683 48 25 C 48 18.525 45.306328 12.670328 40.986328 8.4863281 z M 25 12 C 17.832 12 12 17.832 12 25 C 12 28.546 13.430234 31.762375 15.740234 34.109375 L 19.884766 29.763672 C 18.718766 28.512672 18 26.84 18 25 C 18 21.14 21.14 18 25 18 C 26.134 18 27.203344 18.276813 28.152344 18.757812 L 30.953125 13.455078 C 29.167125 12.530078 27.146 12 25 12 z M 37.533203 12.107422 L 35.464844 14.275391 C 38.257844 17.001391 40 20.799 40 25 C 40 33.271 33.271 40 25 40 C 22.403 40 19.958172 39.335922 17.826172 38.169922 L 16.478516 40.849609 C 19.016516 42.219609 21.918 43 25 43 C 34.925 43 43 34.925 43 25 C 43 19.946 40.899203 15.379422 37.533203 12.107422 z M 34.087891 15.720703 L 29.951172 20.056641 C 31.216172 21.323641 32 23.072 32 25 C 32 28.859 28.86 32 25 32 C 23.694 32 22.474734 31.634766 21.427734 31.009766 L 18.726562 36.378906 C 20.588563 37.408906 22.726 38 25 38 C 32.168 38 38 32.168 38 25 C 38 21.367 36.498891 18.081703 34.087891 15.720703 z M 25 24 A 1 1 0 0 0 25 26 A 1 1 0 0 0 25 24 z"></path>
                                                </svg>
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Music</div>
                            </div>
                        {% elif content.content_type.model == 'game' %}
                            <!--Game-->
                            <div class="bg-light p-3 mb-3">
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3 d-flex">
                                    <div class="mt-1 mb-3 mb-md-0 flex-shrink-0 checkin-cover">
                                        {% if user.pure_text_mode %}
                                            <div class="cover-placeholder bg-light">{{ content.content_object.title }}</div>
                                        {% else %}
                                            {% if content.content_object.cover %}
                                                {% if content.content_object.cover_sens %}
                                                    <img src="{{ content.content_object.cover.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        style="width: 100%"
                                                        class="img-fluid blur cover-border"
                                                        onclick="this.classList.toggle('blur')">
                                                {% else %}
                                                    <img src="{{ content.content_object.cover.url }}"
                                                        alt="{{ content.content_object.title }} cover"
                                                        class="img-fluid cover-border"
                                                        onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\'cover-placeholder\'>{{ content.content_object.title }}</div>';">
                                                {% endif %}
                                            {% else %}
                                                <div class="cover-placeholder">{{ content.content_object.title }}</div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <a href="{% url 'play:game_detail' content.content_object.id %}"
                                           class="text-decoration-none ">
                                            <div class="fs-5">{{ content.content_object.title }}</div>
                                        </a>
                                        {% regroup content.content_object.gamerole_set.all by role as roles_list %}
                                        {% for role in roles_list %}
                                            <div>
                                                {# djlint:off #}
                                                {{ role.grouper.name }}{% if role.list|length > 1 %}s{% endif %}:
                                                {# djlint:on #}
                                                {% for game_role in role.list %}
                                                    {% if not forloop.first %}/{% endif %}
                                                    <a href="{% url 'entity:creator_detail' game_role.creator.id %}">
                                                        {{ game_role.alt_name | default:game_role.creator.name }}
                                                    </a>
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                        <div>
                                            {% if content.content_object.developers %}
                                                {# djlint:off #}
                                                Developer{% if content.content_object.developers.list|length > 1 %}s{% endif %}:
                                                {# djlint:on #}
                                                {% for developer in content.content_object.developers.all %}
                                                    {% if not forloop.first %},{% endif %}
                                                    <a href="{% url 'entity:company_detail' developer.id %}">{{ developer.name }}</a>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        <div>
                                            {% if content.content_object.platforms %}
                                                {# djlint:off #}
                                                Platform{% if content.content_object.platforms.list|length > 1 %}s{% endif %}:
                                                {# djlint:on #}
                                                {% for platform in content.content_object.platforms.all %}
                                                    {% if not forloop.first %},{% endif %}
                                                    <a href="{% url 'play:platform_detail' platform.id %}">{{ platform.name }}</a>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        <div>
                                            {% if content.content_object.release_date %}Release Date: {{ content.content_object.release_date }}{% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% if content.comment %}<div class="mt-3">{{ content.comment }}</div>{% endif %}
                                <div class="text-muted mt-3">Added on {{ content.timestamp|date:"Y.m.d H:i" }} | Game</div>
                            </div>
                        {% else %}
                            <div>
                                <span class="sticky-note">{{ content.order }}</span>
                                <div class="bg-white p-3">
                                    <p class="text-muted">This content type is not supported in List yet.</p>
                                </div>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="bg-light p-3 mb-3">
                            <span class="sticky-note">{{ content.order }}</span>
                            <div class="bg-white p-3">
                                <p class="text-muted">This content has been removed.</p>
                            </div>
                        </div>
                    {% endif %}
                    <hr>
                {% endfor %}
            </div>
            <div class="d-flex flex-column col-sm-4">
                {% if request.user.is_authenticated %}
                    {% if object.allow_collaboration %}
                        <div class="bg-light p-3 mb-3 order-2 order-sm-1">
                            <a class="text-muted" href="{% url 'write:luvlist_update_collab' object.id %}">Edit List</a>
                        </div>
                    {% else %}
                        {% if request.user == object.user %}
                            <div class="bg-light p-3 mb-3 order-2 order-sm-1">
                                <a class="text-muted" href="{% url 'write:luvlist_update' object.user.username object.id %}">Edit List</a>
                            </div>
                        {% endif %}
                    {% endif %}                    
                {% endif %}
                {% if object.wikipedia or object.source %}
                    <div class="bg-light p-3 mb-3 order-1 order-sm-2">
                        <div class="fs-5">Links</div>
                        {% if object.source %}
                        <div>
                            <a href="{{ object.source }}">Source</a>
                        </div>
                        {% endif %}
                        {% if object.wikipedia %}
                        <div>
                            <a href="{{ object.wikipedia }}">Wikipedia</a>
                        </div>
                        {% endif %}
                        
                    </div>
                {% endif %}
                <div class="bg-light p-3 mb-3 order-1 order-sm-2">
                    <div class="fs-5">Statistics</div>
                    {% if book_count > 0 %}
                    <div>
                        Books: {{ book_count }} 
                    </div>
                    {% endif %}
                    {% if movie_count > 0 %}
                    <div>
                        Movies: {{ movie_count }} 
                    </div>
                    {% endif %}
                    {% if series_count > 0 %}
                    <div>
                        Series: {{ series_count }} 
                    </div>
                    {% endif %}

                    {% if release_count > 0 %}
                    <div>
                        Releases: {{ release_count }} 
                    </div>
                    {% endif %}
                    {% if audiobook_count > 0 %}
                    <div>
                        Audiobooks: {{ audiobook_count }} 
                    </div>
                    {% endif %}
                    {% if podcast_count > 0 %}
                    <div>
                        Podcasts: {{ podcast_count }} 
                    </div>
                    {% endif %}
                    {% if game_count > 0 %}
                    <div>
                        Games: {{ game_count }} 
                    </div>
                    {% endif %}
                </div>
                {% if object.allow_collaboration or collaborators|length > 1 %}
                <div class="bg-light p-3 mb-3 order-1 order-sm-3">
                    <div class="d-flex justify-content-start align-items-center flex-wrap">
                        <div class="me-1 fs-5">Contributors</div>
                    </div>
                    <div>
                        {% for collaborator in collaborators %}
                            <span>
                                <a href="{% url 'accounts:detail' collaborator.username %}">
                                    {% if collaborator == object.user %}
                                        <b>{{ collaborator.display_name|default:collaborator.username }}</b>
                                    {% else %}
                                        {{ collaborator.display_name|default:collaborator.username }}
                                    {% endif %}
                                </a>
                            </span>
                            {% if not forloop.last %} / {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

        </div>
    </div>
    {% include 'mathjax+mermaid.html' %}
    <style>
    .sticky-note {
        position: relative;
        top: -1em;
        display: inline-block;
        padding: 0 10px;
        background: #e3e3e3;
        color: #a1a1a1;
        line-height: 18px;
        border-radius: 0 0 4px 4px;
      }
    </style>
{% endblock %}
