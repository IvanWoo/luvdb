{% extends "base.html" %}
{% load url_filters %}
{% load markdownify %}
{% load linkify %}
{% load crispy_forms_tags %}
{% block title %}Pin{% endblock %}

{% block content %}

<div class="container">
    <div class="row">
      <div class="col-sm-8">
        <a href="{% url 'accounts:detail' object.author.username %}">
          {{ object.author.display_name | default:object.author.username }}
        </a> pinned:
        <div style="background-color:#f9f9f9; padding: 1em; margin: 0.5em">
          <p>
            <a href="{{ object.url }}">{{ object.title }}</a> 
            {% comment %} ({{ object.url|root_url }}) {% endcomment %}
            (<a href="{% url 'write:pins_from_url' object.url|root_url %}">{{ pin.url|root_url }}</a>)
          </p>
          {% if object.content %}
          <blockquote>{{ object.content | linkify_tags | linkify_mentions | markdownify | truncatewords:200 }}</blockquote>
          {% endif %}
        </div>
        <span class="d-flex">
          <p class='me-2 text-secondary'>{{ object.timestamp|date:"Y.m.d H:i" }} </p>
          {% if object.author == request.user %}
          <a href="{% url "write:pin_update" object.pk %}" class="me-2">Edit</a>
          <a href="{% url "write:pin_delete" object.pk %}" class="me-2">Delete</a>{% endif %}
        </span>
        <button id="show-comments" class="btn btn-primary btn-sm mx-auto toggle-button">Comments ({{ comments|length }})</button>
        <button id="show-reposts" class="btn btn-secondary btn-sm mx-auto toggle-button">Reposts ({{ object.reposts.count }})</button>
        
        <hr>
  
        <div id="comments-section">
          {% include 'write/comment_in_details.html' with comments=comments object=object comment_form=comment_form object_type='pin' %}
        </div>
  
        <div id="reposts-section" style="display: none;">
          {% include 'write/repost_in_details.html' with object=object repost_form=repost_form reposts=object.reposts%}
        </div>
  
      </div>
    </div>
  </div>
  
  <script>
    var buttons = document.getElementsByClassName('toggle-button');

    for (var i = 0; i < buttons.length; i++) {
        buttons[i].addEventListener('click', function() {
            // Hide all sections and make all buttons secondary
            for (var j = 0; j < buttons.length; j++) {
                var sectionId = buttons[j].id.replace('show-', '') + '-section';
                document.getElementById(sectionId).style.display = 'none';
                buttons[j].classList.remove('btn-primary');
                buttons[j].classList.add('btn-secondary');
            }

            // Show the clicked section and make the button primary
            var sectionId = this.id.replace('show-', '') + '-section';
            document.getElementById(sectionId).style.display = 'block';
            this.classList.remove('btn-secondary');
            this.classList.add('btn-primary');
        });
    }
  </script>
{% endblock content %}
