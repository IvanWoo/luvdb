{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-language" content="en-us">
    <meta name="theme-color" content="#2B3035">
    <meta name="theme-color" content="#F6F7F9" media="(prefers-color-scheme: light)">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description"
            content="LʌvDB is a database of the things you love.">
    <meta name="keywords" content="lʌvdb, luvdb">
    {% block meta %}{% endblock %}
    <!-- Title -->
    <title>{{ luv_list.title }} - Randomizer</title>
    <!-- Favicons -->
    <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="{% static 'img/favicon-32x32.png' %}">
    <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="{% static 'img/favicon-16x16.png' %}">
    <link rel="apple-touch-icon"
            sizes="180x180"
            href="{% static 'img/apple-touch-icon.png' %}">
    <link rel="manifest" href="{% static 'img/randomizer.webmanifest' %}">
    <link rel="icon"
            type="image/png"
            sizes="192x192"
            href="{% static 'img/android-chrome-192x192.png' %}">
    <link rel="icon"
            type="image/png"
            sizes="512x512"
            href="{% static 'img/android-chrome-512x512.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_11__iPhone_XR_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/10.9__iPad_Air_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/10.2__iPad_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/10.2__iPad_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/10.9__iPad_Air_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/12.9__iPad_Pro_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/8.3__iPad_Mini_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_11__iPhone_XR_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/11__iPad_Pro__10.5__iPad_Pro_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/12.9__iPad_Pro_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_15_Pro__iPhone_15__iPhone_14_Pro_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/8.3__iPad_Mini_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{% static 'img/splash_screens/iPhone_15_Pro__iPhone_15__iPhone_14_Pro_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{% static 'img/splash_screens/10.5__iPad_Air_portrait.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{% static 'img/splash_screens/10.5__iPad_Air_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png' %}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{% static 'img/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png' %}">
    
    <!-- Meta Colors -->
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- External Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
            crossorigin="anonymous">        
    <style id="dynamic-styles">
        /* Common styles for both light and dark modes */
        .container {
            margin-top: 3%;
        }
        .card {
            border: none;
        }
        .card-title {
            font-size: 1.5rem;
        }
        .card-text {
            font-size: 1.2rem;
        }
        a {
            color: rgb(110,168,254);
            text-decoration: none;
        }

    </style>
    <script>
        // Auto-detect system theme
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
        const metaThemeColor = document.querySelector("meta[name='theme-color']");
        const dynamicStyles = document.getElementById("dynamic-styles");
        function setTheme() {
            if (prefersDarkScheme.matches) {
                dynamicStyles.innerHTML += `
                    body {
                        background-color: #343a40;
                        color: #fff;
                    }
                `;
                metaThemeColor.setAttribute("content", "#343a40"); 
            } else {
                dynamicStyles.innerHTML += `
                    body {
                        background-color: #f8f9fa;
                        color: #000;
                    }
                `;
                metaThemeColor.setAttribute("content", "#f8f9fa"); 
            }
        }

        setTheme();
        prefersDarkScheme.addEventListener("change", setTheme);

        document.addEventListener("DOMContentLoaded", function() {
            // Your existing JavaScript code here
            document.getElementById('countdown').style.display = 'inline';
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body text-center">
                        {% if item %}
                            <h1 class="mb-3">
                                {% if item.content_object.model_name == "Release" %}
                                    <a href="{% url 'listen:release_detail' item.content_object.id %}" style="text-decoration: underline;">
                                        {{ item.content_object.title }}
                                    </a> 
                                    ({{item.content_object.release_date|slice:":4"}})
                                {% elif item.content_object.model_name == "Book" %}
                                    <a href="{% url 'read:book_detail' item.content_object.id %}" style="text-decoration: underline;">
                                        {{ item.content_object.title }}
                                    </a>
                                    ({{item.content_object.publication_date|slice:":4"}})
                                {% elif item.content_object.model_name == "Movie" %}
                                    <a href="{% url 'watch:movie_detail' item.content_object.id %}" style="text-decoration: underline;">
                                        {{ item.content_object.title }}
                                    </a>    
                                    ({{item.content_object.release_date|slice:":4"}})
                                {% elif item.content_object.model_name == "Series" %}
                                    <a href="{% url 'watch:series_detail' item.content_object.id %}" style="text-decoration: underline;">
                                        {{ item.content_object.title }}
                                    </a>   
                                    ({{item.content_object.release_date|slice:":4"}})
                                {% elif item.content_object.model_name == "Game" %}
                                    <a href="{% url 'play:game_detail' item.content_object.id %}" style="text-decoration: underline;">
                                        {{ item.content_object.title }}
                                    </a>                         
                                    ({{item.content_object.release_date|slice:":4"}})
                                {% endif %}
                            </h1>
                            <div class="mt-3 mb-3">
                                <span>from</span>
                                <a href="{% url 'write:luvlist_detail' luv_list.id %}" style="text-decoration: underline;">
                                    {{ luv_list.title }}
                                </a>
                            </div>
                            {% if item.content_object.cover %}
                                <img src="{{item.content_object.cover.url}}" alt="" class="mb-3 img-fluid">
                                <br>
                                {% if item.content_object.spotify_url %}
                                    <a href="{{item.content_object.spotify_url}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" height="50" viewBox="0 0 50 50">
                                            <path d="M25.009,1.982C12.322,1.982,2,12.304,2,24.991S12.322,48,25.009,48s23.009-10.321,23.009-23.009S37.696,1.982,25.009,1.982z M34.748,35.333c-0.289,0.434-0.765,0.668-1.25,0.668c-0.286,0-0.575-0.081-0.831-0.252C30.194,34.1,26,33,22.5,33.001 c-3.714,0.002-6.498,0.914-6.526,0.923c-0.784,0.266-1.635-0.162-1.897-0.948s0.163-1.636,0.949-1.897 c0.132-0.044,3.279-1.075,7.474-1.077C26,30,30.868,30.944,34.332,33.253C35.022,33.713,35.208,34.644,34.748,35.333z M37.74,29.193 c-0.325,0.522-0.886,0.809-1.459,0.809c-0.31,0-0.624-0.083-0.906-0.26c-4.484-2.794-9.092-3.385-13.062-3.35 c-4.482,0.04-8.066,0.895-8.127,0.913c-0.907,0.258-1.861-0.272-2.12-1.183c-0.259-0.913,0.272-1.862,1.184-2.12 c0.277-0.079,3.854-0.959,8.751-1c4.465-0.037,10.029,0.61,15.191,3.826C37.995,27.328,38.242,28.388,37.74,29.193z M40.725,22.013 C40.352,22.647,39.684,23,38.998,23c-0.344,0-0.692-0.089-1.011-0.275c-5.226-3.068-11.58-3.719-15.99-3.725 c-0.021,0-0.042,0-0.063,0c-5.333,0-9.44,0.938-9.481,0.948c-1.078,0.247-2.151-0.419-2.401-1.495 c-0.25-1.075,0.417-2.149,1.492-2.4C11.729,16.01,16.117,15,21.934,15c0.023,0,0.046,0,0.069,0 c4.905,0.007,12.011,0.753,18.01,4.275C40.965,19.835,41.284,21.061,40.725,22.013z"></path>
                                        </svg>           
                                    </a>    
                                {% endif %}
                                {% if item.content_object.apple_music_url %}
                                    <a href="{{item.content_object.apple_music_url}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" height="50" viewBox="0 0 50 50">
                                            <path d="M37,4H13c-4.962,0-9,4.037-9,9v24c0,4.963,4.038,9,9,9h24c4.962,0,9-4.037,9-9V13C46,8.037,41.962,4,37,4z M35,27v4v0.021	h-0.002C34.986,33.768,32.749,36,30,36h-0.5c-0.987,0-1.933-0.42-2.596-1.152c-0.662-0.731-0.985-1.718-0.887-2.705	C26.195,30.38,27.787,29,29.643,29H31c1.103,0,2-0.897,2-2v-9.795l-12,2.25V30v4c0,2.757-2.243,5-5,5h-0.5	c-0.987,0-1.933-0.42-2.596-1.152c-0.662-0.731-0.985-1.718-0.887-2.705C12.195,33.38,13.787,32,15.643,32H17c1.103,0,2-0.897,2-2	V15.353c0-0.963,0.687-1.79,1.633-1.966l12.591-2.36c0.439-0.083,0.891,0.033,1.234,0.319C34.803,11.632,35,12.053,35,12.5V27z"></path>
                                        </svg>
                                    </a>
                                {% endif %}
                                {% if item.content_object.wikipedia %}
                                <a href="{{item.content_object.wikipedia}}">
                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" height="50" viewBox="0 0 50 50">
                                        <path d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M42,17.56 c0,0.18-0.18,0.35-0.36,0.35h-2.06l-9.21,18.92C30.28,36.91,30.19,37,30.01,37s-0.27-0.09-0.36-0.17l-4.38-8.54l-4.74,8.54 C20.44,36.91,20.35,37,20.17,37s-0.27-0.09-0.36-0.17L10.51,18H8.36C8.18,18,8,17.83,8,17.65v-1.3C8,16.17,8.18,16,8.36,16h7.28 c0.18,0,0.36,0.17,0.36,0.35v1.3c0,0.18-0.18,0.35-0.36,0.35h-1.38l6.45,14.12l3.4-6.1L19.81,18h-1.43c-0.18,0-0.36-0.17-0.36-0.35 v-1.3c0-0.18,0.18-0.35,0.36-0.35h6.26c0.18,0,0.36,0.17,0.36,0.35v1.3c0,0.18-0.18,0.35-0.36,0.35h-1.25l2.42,4.88L28.76,18h-1.4 C27.18,18,27,17.83,27,17.65v-1.3c0-0.18,0.18-0.35,0.36-0.35h5.28c0.18,0,0.36,0.17,0.36,0.35v1.3c0,0.18-0.18,0.35-0.36,0.35 h-1.38l-4.29,7.15l3.49,6.97L37.17,18h-1.81C35.18,18,35,17.83,35,17.65v-1.3c0-0.18,0.18-0.35,0.36-0.35h6.28 c0.18,0,0.36,0.17,0.36,0.35V17.56z"></path>
                                    </svg>
                                </a>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <p class="card-text">No more items to show.</p>
                        {% endif %}
                        
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-body text-center">
                        {% if user.is_authenticated %}
                            <p class="card-text">Welcome back, {{ user.display_name | default:user.username }}!</p>
                            <p class="card-text">
                                <small id="countdown" style="display:none;">Next update in </small>
                                <noscript>
                                    <small>Next update will be at {{ next_generated_datetime | date:"Y-m-d H:i:s" }}</small>
                                </noscript>
                            </p>
                            <span class="d-flex justify-content-center">
                                <a href="{% url 'logout' %}?next={{ request.path }}" class="btn btn-sm btn-danger me-2">Logout</a>
                                <button id="refreshButton" class="btn btn-sm btn-outline-secondary" style="display:none;">Refresh</button>
                            </span>
                        {% else %}
                        <p class="card-text">
                            Viewing today's public, random item. 
                            <br>
                            Log in for your personalized list.
                        </p>
                        <p class="card-text">
                            <small id="countdown" style="display:none;">Next update in </small>
                            <noscript>
                                <small>Next update will be at {{ next_generated_datetime | date:"Y-m-d H:i:s" }}</small>
                            </noscript>
                        </p>
                        
                        <span class="d-flex justify-content-center">
                            <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-sm btn-primary me-2">Login</a>
                            <button id="refreshButton" class="btn btn-sm btn-outline-secondary" style="display:none;">Refresh</button>
                        </span>
                        {% endif %}
                    </div>
                </div>

                <!--Credits-->
                <div class="card mb-3">
                    <div class="card-body text-center">
                        <p class="card-text ">
                            Inspired by <a class="" href="https://1001albumsgenerator.com/" style="text-decoration: underline;">One Album A Day</a>, <br>
                            <!--heart color should be red-->
                            with <span style="color: red;">&#9829;</span> from <a href="https://luvdb.com" style="text-decoration: underline;">LʌvDB</a>
                        </p>
                    </div>
            </div>
        </div>
    </div>
    <script>    
        // Code to show the refresh button for PWA
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            const refreshButton = document.getElementById('refreshButton');
            if (refreshButton) {
                refreshButton.style.display = 'block';
                refreshButton.addEventListener('click', function() {
                    window.location.reload();
                });
            }
        }

        // Your initial time_until_renewal in seconds
        // You can set this value dynamically using Django template variables if needed
        let timeUntilRenewal = {{ time_until_renewal.total_seconds|default:0 }};

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${h}:${m}:${s}`;
        }

        function updateCountdown() {
            if (timeUntilRenewal <= 0) {
                document.getElementById('countdown').textContent = "Refresh the page to see update.";
            } else {
                document.getElementById('countdown').textContent = "Next update in " + formatTime(timeUntilRenewal);
                timeUntilRenewal--;
            }
        }

        // Update the countdown every second
        setInterval(updateCountdown, 1000);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
