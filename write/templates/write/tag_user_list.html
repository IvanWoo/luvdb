{% extends "base.html" %}
{% load markdownify %}
{% load url_filters %}
{% load linkify %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-7 left-column">
                <h2>
                    Entries with tag "{{ tag }}"
                    {% if user %}
                        by <a href="{% url 'accounts:detail' user.username %}">{{ user.display_name | default:user.username }}</a>
                    {% endif %}
                </h2>
                {% if says %}
                    <h3>Says</h3>
                    {% for say in says %}
                        <div class="item mb-4">
                            <div class="mb-2">{{ say.content | linkify_tags:say.user | linkify_mentions | markdownify }}</div>
                            <div>
                                <a href="{% url 'write:say_detail' say.id %}" class='text-muted'>{{ say.timestamp|timesince }} ago</a>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
                {% if pins %}
                    <hr>
                    <h3>Pins</h3>
                    {% for pin in pins %}
                        <div class="mb-2">
                            <div class="bg-light p-3">
                                <a href="{{ pin.url }}">{{ pin.title }}</a>
                                <a href="{% url 'write:pins_from_url' pin.url|root_url %}"
                                class="link-secondary">({{ pin.url|root_url }})</a>
                            </div>
                            {% if pin.content %}
                                <div class="mt-2">{{ pin.content | linkify_tags:pin.user | linkify_mentions | markdownify }}</div>
                            {% endif %}
                        </div>                            
                        <span class="d-flex">
                            <div class='me-2 text-secondary'>
                                <a href="{% url 'write:pin_list' pin.user.username %}"
                                class="text-muted">{{ pin.timestamp|timesince }} ago</a>
                            </div>
                        </span>
                    {% endfor %}
                {% endif %}
                {% if posts %}
                    <hr>
                    <h3>Posts</h3>
                    {% for post in posts %}
                        <div class="item mb-3">
                            <h5>
                                <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                            </h5>
                            <div>{{ post.content | linkify_tags:post.user | linkify_mentions | markdownify }}</div>
                            <p>
                                <small><span class='text-muted'>{{ post.timestamp | date:"Y.m.d H:i" }}</span></small>
                            </p>
                        </div>
                    {% endfor %}
                {% endif %}
                {% if not user %}
                    <hr>
                    <h3>Users</h3>
                    <span class="item">
                        {% for user in users %}
                            <a href="{% url 'accounts:detail' user.username %}">{{ user.display_name | default:user.username }}</a>
                        {% endfor %}
                    </span>
                {% endif %}
            </div>
            <div class="col-sm-5 right-column">
                <!--All tags on the page-->
                <div class="bg-light p-3">
                    <span>
                        {% for tag in all_tags %}
                            <a href="{% url 'write:tag_user_list' user.username tag.name %}"
                               class="text-success me-2">#{{ tag.name }}</a>
                        {% endfor %}
                    </span>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
